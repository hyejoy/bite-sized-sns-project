# ë°ì´í„° ìˆ˜ì • ìš”ì²­ ê´€ë¦¬í•˜ê¸°

- ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ì¶”ê°€Â·ìˆ˜ì •Â·ì‚­ì œ ìš”ì²­ì„ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì‹¤ìŠµ ì§„í–‰
- useQuery hookì„ ì´ìš©í•˜ì—¬ ìƒì„±í•˜ëŠ” íŒ¨ì¹­í•¨ìˆ˜ë¥¼ ê´€ë¦¬í•˜ë„ë¡ ë§Œë“œëŠ”ê±´ ì•ˆë¨
  - Tanstack queryê°€ ì œê³µí•˜ëŠ” useQuery í›…ì€ queryFnì—ëŠ” ë‹¨ìˆœíˆ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ ë¶ˆëŸ¬ì˜¤ê¸°ë§Œ í•˜ëŠ”
    ë¹„ë™ê¸° ìš”ì²­ì„ ê´€ë¦¬í•˜ëŠ” custom hookì´ë‹¤.
- ìƒì„± íŒ¨ì¹­í•¨ìˆ˜ëŠ” tanstack queryê°€ ì œê³µí•˜ëŠ” **useMutation** í›…ì„ í†µí•´ ê´€ë¦¬í•´ ì¤˜ì•¼í•¨

# useMutation

- createTodoí•¨ìˆ˜ì²˜ëŸ¼ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ì‚­ì œí•˜ëŠ” ë“±ì˜ dbë¥¼ ì¡°ì‘í•˜ê±°ë‚˜ ìˆ˜ì •í•˜ëŠ” ë¹„ë™ê¸° ìš”ì²­ì„
  ê´€ë¦¬í•˜ëŠ” ìƒˆë¡œìš´ hookì´ë‹¤.

## mutation ì ìš© ì „ ì½”ë“œ

```tsx
import { useTodosActions } from '@/store/todosStore';
import { useState } from 'react';

export default function TodoEditor() {
  const [content, setContent] = useState('');

  const { createTodo } = useTodosActions(); // zustandë¡œ ê´€ë¦¬í•˜ë˜ createTodo

  const handleAddClick = (e: React.FormEvent) => {
    e.preventDefault(); // í¼ ì œì¶œ ì‹œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ë°©ì§€
    if (content.trim() === '') return;
    createTodo(content);
    setContent('');
  };

  return (
    <form onSubmit={handleAddClick}>
      <div className="flex gap-2">
        <Input
          placeholder="ìƒˆë¡œìš´ í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš” ..."
          value={content}
          onChange={(e) => setContent(e.target.value)}
        />
        <Button type="submit">ì¶”ê°€</Button>
      </div>
    </form>
  );
}
```

## mutation ì ìš© í›„ ì½”ë“œ

- useMutationì„ ì“°ë©´ mutate ë¼ëŠ” í•¨ìˆ˜ë¥¼ ë°˜í™˜í•˜ê²Œ ë˜ëŠ”ë°, ë¹„ë™ê¸° ìš”ì²­ì„ ì ì ˆí•œ íƒ€ì´ë°ì—
  ì§ì ‘ ë°œì†¡í• ìˆ˜ ìˆë„ë¡ í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
- useMutation í›…ìœ¼ë¡œ createToDoí•¨ìˆ˜ì˜ ìƒíƒœê¹Œì§€ ê´€ë¦¬í•  ìˆ˜ ìˆìŒ
- ì¼ë°˜ì ìœ¼ë¡œ createTodoí•¨ìˆ˜ë¥¼ ë¶ˆëŸ¬ë‹¤ê°€ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ í˜¸ì¶œì„ í•˜ê²Œ ë˜ë©´
  ë¹„ë™ê¸° ìš”ì²­ì˜ ìƒíƒœëŠ” ë³„ë„ì˜ stateë¥¼ ë§Œë“¤ì–´ ê´€ë¦¬ë¥¼ í•´ì•¼í•˜ëŠ”ë°, useMutationì„ ì´ìš©í•˜ë©´ ë¹„ë™ê¸° ìš”ì²­ìœ¼ ìƒíƒœê¹Œì§€ ê´€ë¦¬ ê°€ëŠ¥

```tsx
/** createTodo.ts */
import { API_URL } from '@/lib/constants';
import type { Todo } from '@/types';

export async function createTodo(content: string) {
  const res = await fetch(`${API_URL}/todos`, {
    method: 'post',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      content,
      isDone: false,
    }),
  });

  if (!res.ok) throw new Error('create todo failed');
  const data: Todo = await res.json();
  return data;
}
```

```tsx
import { useMutation } from '@tanstack/react-query';
import { useState } from 'react';

export default function TodoEditor() {
  const [content, setContent] = useState('');

  const { mutate, is } = useMutation({
    mutationFn: createTodo,
  });

  const handleAddClick = (e: React.FormEvent) => {
    e.preventDefault();
    if (content.trim() === '') return;
    mutate(content); // ì¶”ê°€ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ mutateí•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë©´ì„œ ê²°ê³¼ì ìœ¼ë¡œ createTodoí•¨ìˆ˜ê°€ ì‹¤í–‰ë¨
    setContent('');
  };

  return (
    <form onSubmit={handleAddClick}>
      <div className="flex gap-2">
        <Input
          placeholder="ìƒˆë¡œìš´ í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš” ..."
          value={content}
          onChange={(e) => setContent(e.target.value)}
        />
        <Button type="submit">ì¶”ê°€</Button>
      </div>
    </form>
  );
}
```

- ìš”ì²­ì˜ ë¡œë”© ìƒíƒœ ì¶”ì í•˜ê³  ì‹¶ì„ë•,mutateì™€ í•¨ê»˜ ë°˜í™˜ë˜ëŠ” isPenting ê°’ í™œìš©í•˜ë©´ ë¨
- ë°ì´í„° ìš”ì²­ì‹œ button disabled ì²˜ë¦¬í•  ë•Œ ì“¸ ìˆ˜ ìˆìŒ

```tsx
const { mutate, isPending } = useMutation({
  mutationFn: createTodo,
});
...
  return (
        <Button disabled={isPending} type="submit">
          ì¶”ê°€
        </Button>
  );
```

## mutatation handler function

- useMutationì€ ì˜µì…˜ ê°ì²´ ì•ˆì— 4ê°€ì§€ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ì„¤ì • í•  ìˆ˜ ìˆìŒ
  - 1. onMutate : ìš”ì²­ì´ ë°œì†¡ë˜ì—ˆì„ë•Œ
  - 2. onSettled : ìš”ì²­ì´ ì¢…ë£Œ ë˜ì—ˆì„ë•Œ
  - 3. onSuccess : ìš”ì²­ì´ ì„±ê³µí–ˆì„ ë•Œ
  - 4. onError : ìš”ì²­ì´ ì‹¤íŒ¨í–ˆì„ ë•Œ

```tsx
/** TodoEditor.tsx */
export default function TodoEditor() {
  const [content, setContent] = useState('');

  const { mutate, isPending } = useMutation({
    mutationFn: createTodo,
    onMutate: () => {}, //ğŸ‘ˆ ìš”ì²­ ë°œì†¡ë˜ì—ˆì„ë•Œ
    onSettled: () => {}, //ğŸ‘ˆ ìš”ì²­ ì¢…ë£Œ
    onSuccess: () => {
      window.location.reload();
    }, //ğŸ‘ˆ ìš”ì²­ ì„±ê³µ
    onError: (error) => {
      window.alert('ìš”ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      console.log(error.message + 'ë¥¼ ì œê³µí•©ë‹ˆë‹¤.');
    }, //ğŸ‘ˆ ìš”ì²­ ì‹¤íŒ¨
  });

  const handleAddClick = (e: React.FormEvent) => {
    e.preventDefault();
    if (content.trim() === '') return;
    mutate(content); // ì¶”ê°€ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ mutateí•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë©´ì„œ ê²°ê³¼ì ìœ¼ë¡œ createTodoí•¨ìˆ˜ê°€ ì‹¤í–‰ë¨
    setContent('');
  };

  return (
    <form onSubmit={handleAddClick}>
      <div className="flex gap-2">
        <Input
          placeholder="ìƒˆë¡œìš´ í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš” ..."
          value={content}
          onChange={(e) => setContent(e.target.value)}
        />
        <Button disabled={isPending} type="submit">
          ì¶”ê°€
        </Button>
      </div>
    </form>
  );
}
```

### mutation custom hook

- useQueryì²˜ëŸ¼ mutationë„ ì»¤ìŠ¤í…€ í›…ìœ¼ë¡œ ë”°ë¡œ ê´€ë¦¬í•˜ëŠ”ê²Œ ì¢‹ìŒ

```tsx
/** src/hooks/mutations/useCreatTodoMutation.ts */

import { createTodo } from '@/api/createTodo';
import { useMutation } from '@tanstack/react-query';

export function useCreateTodoMutation() {
  return useMutation({
    mutationFn: createTodo,
    onMutate: () => {},
    onSettled: () => {},
    onSuccess: () => {},
    onError: () => {},
  });
}

/** TodoEditor.tsx */
const { mutate, isPending } = useCreateTodoMutation();
```
