# React ì•±ì˜ ìƒíƒœ ë¶„ë¥˜

- ì§€ì—­ ìƒíƒœ : íŠ¹ì •ë²”ìœ„ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥
  - ì¸í’‹ íƒœê·¸ì˜ ì‚¬ìš©ì ì…ë ¥ ê°’
- ì „ì—­ ìƒíƒœ : ì „ì²´ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥
  - ì•±ì˜ í…Œë§ˆ ë°ì´í„°, ì„¸ì…˜ ì •ë³´ ë°ì´í„°

- APIì˜ ìš”ì²­ê³¼ ê´€ë ¨ëœ ë°ì´í„°ë“¤ì€ ì§ì ‘ ê´€ë¦¬í•´ì•¼ ë˜ëŠ” ë°ì´í„°ì˜ ê°€ì§“ìˆ˜ê°€ ë„ˆë¬´ ë§ì•„
  Zustandë¥¼ í™œìš©í•´ ì „ì—­ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸°ì—” ë¬´ë¦¬ê°€ ìˆìŒ
- ê·¸ë ‡ë‹¤ê³  ì§€ì—­ ìƒíƒœë¡œ ê´€ë¦¬í•˜ê¸°ì—” ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë°ì´í„°ì— ì ‘ê·¼í•˜ê¸°ê°€ ì–´ë ¤ì›€, ì½”ë“œë„ ë³µì¡í•´ì§
- ì‹¤ë¬´ì—ì„œëŠ” ë³´í†µ **ì„œë²„ ìƒíƒœ** ìœ í˜•ìœ¼ë¡œ ê´€ë¦¬í•¨
- ì„œë²„ ìƒíƒœ ê´€ë¦¬ë¥¼ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ **TanStack Query**ë¥¼ ì‚¬ìš©í•œë‹¤.
  ![alt text](image.png)

## ì‹¤ìŠµìš© ì„œë²„ ì‹¤í–‰

```bash
npm i json-server -D
npx json-server server/db.json [ì‹¤í–‰]
```

- JSON í˜•íƒœì˜ íŒŒì¼ì„ ì´ìš©í•´ì„œ ê°„ë‹¨í•œ APIì„œë²„ë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” ë„êµ¬
- í•´ë‹¹ í”„ë¡œì íŠ¸ì—ì„œëŠ” server/db.json ì´ìš©
- ë¦¬ì•¡íŠ¸ì•±ì˜ íŒŒì¼ë¡œ ê°„ì£¼ë˜ì§€ ì•Šë„ë¡, Vite ì„¤ì • íŒŒì¼ì— ì˜µì…˜ì¶”ê°€í•´ì£¼ê¸° (ìˆ˜ì • ì‹œ ë¦¬ëœë”ë§X)

```json
// server/db.json
{
  "todos": [
    {
      "id": 1,
      "content": "Todo 1",
      "isDone": true
    },
    {
      "id": 2,
      "content": "Todo 2",
      "isDone": true
    },
    {
      "id": 3,
      "content": "Todo 3",
      "isDone": false
    }
  ]
}
```

```ts
// vite.config.ts
export default defineConfig({
  plugins: [react(), tailwindcss()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
  server: {
    watch: {
      ignored: ['**/server/**'], // ì„œë²„í´ë”ì˜ ë³€ê²½ì‚¬í•­ ê°ì§€ì•ˆí•¨
    },
  },
});
```

## TanStack Query

```bash
npm i @tanstack/react-querybash
```

```jsx
// example
export default function Component() {
    const {data, isLoading, error} = useQuery(...);
    if(error) return <div>ì˜¤ë¥˜ ë°œìƒ</div>
    if(isLoading) return <div>ë¡œë”© ì¤‘ ì…ë‹ˆë‹¤..</div>
    return <div>{data}</div>
}
```

- ìš”ì²­ì´ ì‹¤íŒ¨ í–ˆì„ ë•Œ **retry**ë¼ëŠ” ì˜µì…˜ì„ í†µí•´ ë‹¤ì‹œ í•œë²ˆ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ë„ ìˆê³ 
  ìºì‹œê°’ì„ ì´ìš©í•´ ì¤‘ë³µ ìš”ì²­ì„ ë°©ì§€í•˜ëŠ” ë“±ì˜ ì„œë²„ ìƒíƒœ ê´€ë¦¬ë¥¼ ìœ„í•œ êµ‰ì¥íˆ ë‹¤ì–‘í•œ ê¸°ëŠ¥ë“¤ì´ ì œê³µëœë‹¤.
- TanStack QueryëŠ” ë¹„ë™ê¸° ìš”ì²­ì˜ ìƒíƒœë¥¼ ë§¤ìš° í¸ë¦¬í•˜ê²Œ ê´€ë¦¬í•˜ë„ë¡ ë„ì™€ì£¼ëŠ” ë‹¤ì–‘í•œ ê¸°ëŠ¥ë“¤ì„ ì œê³µí•˜ê³  ìˆë‹¤.

### ë°ì´í„° ì¡°íšŒ ìš”ì²­ê´€ë¦¬í•˜ê¸°

#### 1. QueryClientProvider ì»´í¬ë„ŒíŠ¸ ë¶ˆëŸ¬ì™€ main ì»´í¬ë„ŒíŠ¸ë¥¼ ê°ì‹¸ê³ , client props ë„˜ê¸°ê¸°

- **QueryClient** : TanStack Queryë¥¼ ì´ìš©í•´ì„œ ê´€ë¦¬í•˜ëŠ” ëª¨ë“  ì„œë²„ ìƒíƒœë¥¼ ë³´ê´€í•˜ëŠ” ìŠ¤í† ì–´ ê°œë…
  API ì‘ë‹µê°’, ìºì‹± ê°’, ìºì‹œ ì˜µì…˜ë“¤ ë“± ë‹¤ì–‘í•œ ê°’ë“¤ì´ ë³´ê´€ë¨

```tsx
...
import { QueryClientProvider, QueryClient } from '@tanstack/react-query';


const queryClient = new QueryClient(); // TanStack Queryë¥¼ ì´ìš©í•´ì„œ ê´€ë¦¬í•˜ëŠ” ëª¨ë“  ì„œë²„ ìƒíƒœë¥¼ ë³´ê´€í•˜ëŠ” ì¼ì¢…ì˜ ìŠ¤í† ì–´ ê°œë…
createRoot(document.getElementById('root')!).render(
  <BrowserRouter>
    <QueryClientProvider client={queryClient}>
      <App />
    </QueryClientProvider>
  </BrowserRouter>
);
```

#### 2. ë°±ì—”ë“œ ì„œë²„ì—ì„œ ì œê³µí•˜ëŠ” ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

```tsx
/**TodolistPage.tsx
 * ğŸ™€ TanStack Query ì ìš© ì „ ì½”ë“œ */

async function fetchTodos() {
  const res = await fetch('http://localhost:3000/todos');
  if (!res.ok) throw new Error('err');

  const data: Todo[] = res.json();
  return data;
}

export default function TodoListPage() {
  const [todos, setTodos] = useState<Todo[]>([]);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState();

  const fetchData = async () => {
    setIsLoading(true);
    try {
      const data = await fetchTodos();
      setTodos(data);
    } catch (err) {
    } finally {
      setIsLoading(false);
    }
  };

  useEffect(() => {
    fetchData();
  }, []);
}
```

```tsx
/**
 * TanStack Query ì ìš© í›„ ì½”ë“œ
 */

import { useQuery } from '@tanstack/react-query';

export default function TodoListPage() {
  // useQuery hookì´ ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ ë˜ì—ˆì„ë•Œ queryFnìœ¼ë¡œ ì„¤ì •í•œ í•¨ìˆ˜ë¥¼ ìë™ìœ¼ë¡œ í˜¸ì¶œí•˜ê³  queryKeyì˜ ì´ë¦„ìœ¼ë¡œ ì €ì¥í•¨

  // ë°˜í™˜ê°’ìœ¼ë¡œëŠ” data(fetch res) , isLoadingg(fetchLoadingìƒíƒœ), error ë“±ë“± ìë™ìœ¼ë¡œ ì œê³µ
  const {
    data: todos,
    isLoading,
    error,
  } = useQuery({
    queryFn: fetchTodos, // ë§Œë“¤ì—ˆë˜ fetchí•¨ìˆ˜ ì „ë‹¬
    queryKey: ['todos'],
    // TanStack Query ìë™ ì¬ì‹œë„ ê¸°ëŠ¥ ì„¤ì • (ê¸°ë³¸ê°’ìœ¼ë¡œ 3ë²ˆì‹¤í–‰ë¨)
    // retry: 0
  });

  if (error) return <div>error</div>;
  if (isLoading) return <div>Loading...</div>;
  return (
    <div>
      {todos.map((todo) => (
        <TodoItem {...todo}></TodoItem>
      ))}
    </div>
  );
}
```

#### 3. fetch í•¨ìˆ˜ Â· TanStack Query ë¶„ë¦¬í•˜ê¸°

- fetch í•¨ìˆ˜ëŠ” src/api/fetchTodos.ts ë¡œ ë¶„ë¦¬
- useQuery src/hooks/quries/useTodos.data.ts ë¡œ custom hookìœ¼ë¡œ ë¶„ë¦¬

```tsx
/**src/hooks/quries/useTodos.data.ts */
import { fetchTodos } from '@/api/fetchTodos';
import { useQuery } from '@tanstack/react-query';

// useTodoDataë¥¼ í˜¸ì¶œí•˜ë©´ ìë™ìœ¼ë¡œ fetchTodosê°€ ì‹¤í–‰ë˜ì–´
// í•´ë‹¹ ìš”ì²­ì˜ ìƒíƒœê°’ì„ ì–´ë””ë“ ì§€ ì“¸ ìˆ˜ ìˆê²Œ ëœë‹¤.

export function useTodosData() {
  return useQuery({
    queryFn: fetchTodos,
    queryKey: ['todos'],
    // retry: 0, ì—ëŸ¬ì‹œ ì¬ì‹œë„ í•˜ì§€ ì•Šê¸°
  });
}
```
